# Spondex monitoring configuration (generated by Ansible)
# Edit inventory/group vars to override values; this file is meant to stay human-readable.
# Manual tweaks on the host are allowed. They will only be replaced when
# `monitor_overwrite_config=true` is passed to Ansible.

state_path: {{ monitor_state_path }}
retention_days: {{ monitor_retention_days }}

# --- Thresholds ------------------------------------------------------------
load_window_minutes: {{ monitor_load_window_minutes }}
memory_threshold: {{ monitor_memory_threshold }}

# --- Runtime ---------------------------------------------------------------
docker_service: {{ monitor_docker_service }}
compose_file: {{ app_root }}/docker-compose.prod.yml

app_checks:
{% if monitor_app_containers %}
{% for item in monitor_app_containers %}
  - container: {{ item.name }}
    name: {{ item.label }}
{% endfor %}
{% else %}
  - container: spondex-app-1
    name: app
{% endif %}

db_check:
  container_name: {{ monitor_db_container }}
  host: {{ monitor_db_host }}
  port: {{ monitor_db_port }}
  user: {{ monitor_db_user }}
  database: {{ monitor_db_name }}
  password_env_var: POSTGRES_PASSWORD

log_checks:
{% if monitor_log_files %}
{% for log in monitor_log_files %}
  - path: {{ log.path }}
    pattern: {{ log.pattern }}
{% endfor %}
{% else %}
  - path: /opt/spondex/logs/app.log
    pattern: Traceback
{% endif %}

disk_devices:
{% if monitor_disks %}
{% for device in monitor_disks %}
  - name: {{ device.name }}
    max_iops: {{ device.max_iops }}
    include_reads: {{ device.include_reads | string | lower }}
    include_writes: {{ device.include_writes | string | lower }}
{% endfor %}
{% else %}
  - name: sda
    max_iops: 1000
    include_reads: true
    include_writes: true
{% endif %}

disk_usage_paths:
{% if monitor_disk_usage %}
{% for usage in monitor_disk_usage %}
  - name: {{ usage.name }}
    path: {{ usage.path }}
    warn_percent: {{ usage.warn_percent }}
    critical_percent: {{ usage.critical_percent }}
    min_free_gb: {{ usage.min_free_gb }}
{% endfor %}
{% else %}
  - name: root
    path: /
    warn_percent: 85
    critical_percent: 95
    min_free_gb: 2
{% endif %}

notification:
  mail_to:
{% if monitor_mail_to %}
{% for recipient in monitor_mail_to %}
    - {{ recipient }}
{% endfor %}
{% else %}
    - root@localhost
{% endif %}
  mail_from: {{ monitor_mail_from }}
  subject_prefix: {{ monitor_mail_subject }}

enable_email: true
{% if monitor_mail_cc %}
additional_recipients:
{% for recipient in monitor_mail_cc %}
  - {{ recipient }}
{% endfor %}
{% else %}
additional_recipients: []
{% endif %}
