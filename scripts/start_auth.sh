#!/bin/bash

# Переходим в корневую директорию проекта
cd "$(dirname "$0")/.."

# Проверка наличия файла .env
if [ ! -f .env ]; then
    echo "Ошибка: Файл .env не найден!"
    echo "Создайте файл .env на основе .env.example"
    exit 1
fi

# Создаём временное окружение
echo "Создание временного виртуального окружения..."
python -m venv temp_venv

# Активируем окружение
source temp_venv/bin/activate

# Устанавливаем необходимые зависимости
echo "Установка зависимостей..."
pip install spotipy python-dotenv

# Запускаем скрипт аутентификации
echo "Запуск аутентификации Spotify..."
python scripts/spotify_auth.py

# Деактивируем окружение
deactivate

# Удаляем временное окружение
echo "Удаление временного виртуального окружения..."
rm -rf temp_venv

if [ ! -f .cache ]; then
    echo "Ошибка: Аутентификация не удалась или кэш не был создан."
    exit 1
fi

echo "Аутентификация успешно завершена!"
echo "Файл .cache создан и готов к использованию в Docker."
echo "Теперь вы можете запустить скрипт scripts/start.sh для запуска приложения."

